package net.sonic.tests;

import static org.junit.Assert.*;

import org.json.JSONObject;
import org.junit.Test;
import io.jsonwebtoken.impl.Base64UrlCodec;
import net.sonic.gsls.model.SocialRecord;
import net.sonic.gsls.model.SocialRecordIntegrityException;

public class SocialRecordTest
{
	private SocialRecord socialRecord;
	private JSONObject data;
	private String jwt = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzb2NpYWxSZWNvcmQiOiJleUpBWTI5dWRHVjRkQ0k2SW1oMGRIQTZMeTl6YjI1cFl5MXdjbTlxWldOMExtNWxkQzhpTENKQWRIbHdaU0k2SW5OdlkybGhiSEpsWTI5eVpDSXNJblI1Y0dVaU9pSjFjMlZ5SWl3aVoyeHZZbUZzU1VRaU9pSTBPREF5UXpoRVJUWlZXbG8xUWtsRFVVazRNekJCT0ZBNFFsY3pXVUkxUlVKUVIxaFhUbEpJTVVWUU4wZzRNemhXTnlJc0luQnNZWFJtYjNKdFIwbEVJam9pTWxWYVEwRkpNa2ROTkRWVU1UWXdUVVJPTkRSUFNWRTRSMHRPTlVkSFEwdFBPVFpNUXpsYVQxRkRRVVZXUVZWU1FUZ2lMQ0prYVhOd2JHRjVUbUZ0WlNJNklrRnNhV05sSWl3aWNISnZabWxzWlV4dlkyRjBhVzl1SWpvaWFIUjBjRG92TDNOdlkybGhiQzV6Ym1WMExuUjFMV0psY214cGJpNWtaUzl6YjI1cFl5MXpaR3N2SWl3aWNHVnljMjl1WVd4UWRXSnNhV05MWlhraU9pSXRMUzB0TFVKRlIwbE9JRkJWUWt4SlF5QkxSVmt0TFMwdExVMUpTVU5KYWtGT1FtZHJjV2hyYVVjNWR6QkNRVkZGUmtGQlQwTkJaemhCVFVsSlEwTm5TME5CWjBWQmVrMXdNRzExYTJGTVVXd3lXV0V3VW0xYVMzUnBiMWg0TTJkcFpsUmxOa0oxTWxWVmMzSlBaM2RrTDFOSVFqTm5ORE00Y0dOS1FuRkdPSEIyVUV0TGFIZ3dhR2R3T0UxWU1WY3pTVWQ1Y1hOT2MwbGlSa1l5WWpSeU9WWnlkRVJ4VlZWa01GZENRMHR6ZGtKT1kzRjRabkZYYTJWNk1tdFdRaXRSTTJoUmEwOXFlVzlqZFU4NFNUWjJNWEoyYTBaT2MybHZNRVU1V0V4UVkweFBhVmxLVEROeFNISmlVVVpKSzNGMGMyaG1aMnBsU3psMFlWcGlja1ZZTm5WWk5GWlJOakF5Wm1JNFpFaExPV2xsUTFZdlZ6UTJVa05VVVZNMEsyRmpNU3Q1TVVOQmVVZzNaMUUxVkZCTldqSjJjbUZsVEZJMGEwRXhjamhzTDNVeldtaENPR0k0WW1sTmREZ3hTeTlYVm1ORlppczRTelJNUVdrdlZIVmlNWFZFYjNkTFZUSklUblpsUnpWdmRqQTFOV2gyWW5aWmRpODVlakZyUlVaSGNGUkZUVTk2YkRCb2FVczBSRWRyZG5CMVoxWlBPVzVWWm5sNU4xWkJPRFZhWjJ0Q2NGazBWMjlJUjI5YVVXSjFZbmxDYzAxM2NYQnRWREZ3YTFWM1FWRlVTMjUyTmsxRk1WbE1URms0TVZscVpYTm9VWG9yV1dWNlZDOW5jVWd3ZFVNellTdGFZMUZ2ZEVaaGJrNTVWSFpSY25ScWVGRlRjV1ZQUVRnM1N6RlNkMlpLZG00NVVWTTBUSG96VFUxME9HVlRTekV2U0N0aFJtRjJSRUpCVW1kNlFVZFFaMFJTUWxSMGFrdFRkbVJKYlZveFp6VjZaRGx3U1hSNlIxWTVXbU5oYzNaVVdUTXZiVFpWTlV3NVFubHBhVVpGU0V4UlNuSTVaVXRDWWpCUFFXOVJWa2M1UnpWMldWRXhaakZEUmpkUGRGbFJRVEpNTUhsbll6UlVkM2RNUTJwSlRFSktSRzl4YVU5MVdXZHhMM2RXZWtVeE1qQXdSekYwVVRVd05HaE1aR0ZWU2tsRlZFTk1lSFpFYUhsTlNUTlVZbmwzZUV4VGVXbG9XV3BETTFSblpUWTRXQ3R5UzFCbldtOVpOR0ZvVkc5ck1FTnplazk2V1dZMGJFUnpXVzFMUVZCSlZrUklOVU0xUVVWRFFYZEZRVUZSUFQwdExTMHRMVVZPUkNCUVZVSk1TVU1nUzBWWkxTMHRMUzBpTENKaFkyTnZkVzUwVUhWaWJHbGpTMlY1SWpvaUxTMHRMUzFDUlVkSlRpQlFWVUpNU1VNZ1MwVlpMUzB0TFMxTlNVbERTV3BCVGtKbmEzRm9hMmxIT1hjd1FrRlJSVVpCUVU5RFFXYzRRVTFKU1VORFowdERRV2RGUVhablpYQjBiMWxKVmtSMmVGQlFTV3MwV2tKd1Vua3ZVMjlvY0VwUVZFaFRaM1ZRTTFacVYwY3dlRXc0ZW14c1dsTnJaRUpNVXpGcGFrSkhRM2hITDJwNE5VdGxZa0pUVEZOclNVRnFSV1JpZVRBdlJrdFNha3hVUW5GRE4yVmhhelp6THpGNlZWVjZiMEZDV0hkMUwwcGphMEZVYjA5S1N6VlNMMmxUZDBGa05XcFBZVGswUW13MmNUZFFkVFpyWmtKelJGTm5ORE5LVDJ0SlZUQnlkbVpOVG1OblpHOHZPVWRLZDBreWRHYzJMMXBxVFRWWlYwNXZVbU5JZG13eVdGaE5NR3hzYWtweWVHWldiRmh3VjA1b1ZGVlZiM2t2U1hKdWVWQm9RbXhvU0VOWWRHSkRWbTh2VlRWblVUVlBObmx0Y1hkbGQxSjVWM2RvWm5aaFYzSlhhWGRCVnpaTGJuWkNlak5rWkVOdGFrSkJjbVZ5VDJOcFZuUmpVMWhTYjBvd01XcFJVRFJJWlVSVWVsRkVlSFpFWWpSNWJVRmxkMlp2VW5WNmNEQmpkRXcwZEUxTlV6aFFLMWg0Y0ZGdFRuSnBkbHBRSzNSb2QwVk5LMnBDT0ZoTWEySkdRakZRYWpCaFZHUlJla05yY2twMWNHbFRlamh0U3pWaFFrSndkR3BRYzJWck5UQmxaMjlQUlhsbU5VeFpNM2t2WkdGMWNEVnlZa3hHVEVVMU9IQk9UekV6UjJSMFJHbHBiakJPUkZaM2NrTXhPWFZMY25aNU5YWmpZUzhyVHpGc1dtcFVZVlpPY2xBNVJrNDVkV2N5ZDFvMk1rNDNVVFoyZVZwVU1FZ3JOM2RyWkdKSFYyVkxhSGhOWVRGcU1EVmtlREIyTmpGa2NEa3hhelpPTkhkWFdFVmxRV3R1VEhjd05rWnlRMHRwWTB0cVFUWk1VVWxXY2xRNVMxbHFWMFJKT1dWM2QyRnZTMkpTZVhKTFNuSklUbTlhWnpFclRYVmhLM2d6VkZkeldFRkZSMFU1TVN0TloyUmtNRlZhVVN0WVFtbG9hbmx4TnpaalkxcFZUR0o2U2k5bWJFZGxUM2xXVlUxM1dHY3dOVkZPVkRaNldGSkVlVTVWVUZWNVlqaEliMGt3YTBoc1ZEaHVVa1JHT1d0clMzVXlXWGcwTUVWb2MzSkJVVzluYjBWeFozaGxXVzlWUTBGM1JVRkJVVDA5TFMwdExTMUZUa1FnVUZWQ1RFbERJRXRGV1MwdExTMHRJaXdpYzJGc2RDSTZJbUZpWWpCaFptUXlPRGxtTVRBeVpqTWlMQ0prWVhSbGRHbHRaU0k2SWpJd01UWXRNREV0TVROVU1UQTZOVGc2TlRRck1ERTZNREFpTENKaFkzUnBkbVVpT2pFc0ltdGxlVkpsZG05allYUnBiMjVNYVhOMElqcGJYWDA9In0.PuhY9aaNnaUEciup6UBpUxOkKCg9pca74ShRYD0hb6EY-2UrzLTmw3frk-730gnYeYbU3VmQS5viuxq0NjZiAJ71gfI39jtYLUJmUNQ698ne-J9xmH8_P4w8p3711LatV_SSm31kyveO_Y7aDlceSoKolL622A594SbFFN7jZQhiGpiaIZPyjxFE0T1iqHpWVCPnm4OIRBo-iQy-eGY5ZnLnWfnasoQKEWskSU-wUTpOOYvMlq1wDsShyfOqA3VhKUX03l2gymjlyNVAdmPVnRwtOaOnLnyimwO7F03o8QTB_qT0--1qsYX_vr8mRDw4qg7EP2jgv5NdXgs_hOKFglQf9LpAoV_574BxDe32WQUxjbAjv2PllBNlTxWXAAeTh_R0fCr5c6fB5GYAO1u3peKXZkKFTUyIcDKY7p5xBhBYsVs9TgGbVKODoMD6AMc4St-3FSFuhHCL-bwO7-Yukv54HZGrOu5wlCNtjyoXfc9WRQ1VCJdfutDvTOm4AiWnDvM0c2J8k3k68I-t9kmhyVmjjgsPaZQYCxG8Os1e_cqojUrgXgz66hGWRpdsp48_e_YMXEwqgr4U7D1Vpz5TGh-8w4axpSn7JXKFewamhIJ0dn4Mdpbe0mKwe04tkApGGONKdSoX95a2hlNEapUCbEYAJTHQ_ZyIYtMDAByBZTQ";
	
	@Test
	public void test()
	{
		// decode JWT
		JSONObject jwtPayload = new JSONObject(new String(Base64UrlCodec.BASE64URL.decodeToString(jwt.split("\\.")[1])));
		data = new JSONObject(Base64UrlCodec.BASE64URL.decodeToString(jwtPayload.get("socialRecord").toString()));
		
		try
		{
			socialRecord = SocialRecord.createFromJSONObject(data);
			socialRecord.validate();
		}
		catch (SocialRecordIntegrityException e)
		{
			fail("SocialRecordIntegrtiyException thrown: " + e.getMessage());
		}
	}
}